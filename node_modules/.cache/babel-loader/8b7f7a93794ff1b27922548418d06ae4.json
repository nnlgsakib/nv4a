{"ast":null,"code":"import _regeneratorRuntime from\"/root/experiment/nova-explorer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/root/experiment/nova-explorer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/root/experiment/nova-explorer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import ERPC from\"@etclabscore/ethereum-json-rpc\";import React,{useState,useEffect}from\"react\";function useEthRPC(queryUrlOverride){var _React$useState=React.useState(),_React$useState2=_slicedToArray(_React$useState,2),erpc=_React$useState2[0],setErpc=_React$useState2[1];var _React$useState3=React.useState(),_React$useState4=_slicedToArray(_React$useState3,2),selectedChain=_React$useState4[0],setSelectedChain=_React$useState4[1];var _useState=useState(queryUrlOverride||process.env.REACT_APP_ETH_RPC_URL),_useState2=_slicedToArray(_useState,1),urlOverride=_useState2[0];useEffect(function(){if(selectedChain===undefined&&!urlOverride){return;}var rpcUrl=selectedChain===null||selectedChain===void 0?void 0:selectedChain.rpc.reduce(function(curr,toCheck){if(curr!==selectedChain.rpc[0]){return curr;}if(toCheck.indexOf(\"${\")!==-1){return curr;}return toCheck;},selectedChain.rpc[0]);var runAsync=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var parsedUrl,newUrl,rpc,protocol,fallbackPort,port;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:newUrl=urlOverride||rpcUrl;if(newUrl){_context.next=3;break;}return _context.abrupt(\"return\");case 3:_context.prev=3;parsedUrl=new URL(newUrl);_context.next=11;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](3);alert(\"invalid rpc url \"+newUrl);return _context.abrupt(\"return\");case 11:_context.prev=11;protocol=parsedUrl.protocol.split(\":\")[0];fallbackPort=protocol===\"http\"?80:443;port=parseInt(parsedUrl.port,10);rpc=new ERPC({transport:{host:parsedUrl.hostname,port:port?port:fallbackPort,type:protocol,path:parsedUrl.pathname}});_context.next=21;break;case 18:_context.prev=18;_context.t1=_context[\"catch\"](11);return _context.abrupt(\"return\");case 21:if(rpc){setErpc(rpc);}case 22:case\"end\":return _context.stop();}}},_callee,null,[[3,7],[11,18]]);}));return function runAsync(){return _ref.apply(this,arguments);};}();runAsync();return function(){if(erpc){erpc.rpc.requestManager.close();}};// eslint-disable-next-line react-hooks/exhaustive-deps\n},[selectedChain]);return[erpc,setSelectedChain];}export default useEthRPC;","map":{"version":3,"names":["ERPC","React","useState","useEffect","useEthRPC","queryUrlOverride","_React$useState","_React$useState2","_slicedToArray","erpc","setErpc","_React$useState3","_React$useState4","selectedChain","setSelectedChain","_useState","process","env","REACT_APP_ETH_RPC_URL","_useState2","urlOverride","undefined","rpcUrl","rpc","reduce","curr","toCheck","indexOf","runAsync","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","parsedUrl","newUrl","protocol","fallbackPort","port","wrap","_callee$","_context","prev","next","abrupt","URL","t0","alert","split","parseInt","transport","host","hostname","type","path","pathname","t1","stop","apply","arguments","requestManager","close"],"sources":["/root/experiment/nova-explorer/src/hooks/useEthRPC.ts"],"sourcesContent":["import ERPC from \"@etclabscore/ethereum-json-rpc\";\nimport React, { Dispatch, useState, useEffect } from \"react\";\nimport { IChain as Chain } from \"../models/chain\";\n\nfunction useEthRPC(queryUrlOverride?: string): [ERPC, Dispatch<Chain>] {\n  const [erpc, setErpc] = React.useState<ERPC>();\n  const [selectedChain, setSelectedChain] = React.useState<Chain>();\n  const [urlOverride] = useState(queryUrlOverride || process.env.REACT_APP_ETH_RPC_URL);\n\n  useEffect(() => {\n    if (selectedChain === undefined && !urlOverride) { return; }\n\n    const rpcUrl = selectedChain?.rpc.reduce((curr, toCheck) => {\n      if (curr !== selectedChain.rpc[0]) { return curr; }\n      if (toCheck.indexOf(\"${\") !== -1) { return curr; }\n      return toCheck;\n    }, selectedChain.rpc[0]);\n\n    const runAsync = async () => {\n      let parsedUrl;\n      const newUrl = urlOverride || rpcUrl;\n      if (!newUrl) { return; }\n      try {\n        parsedUrl = new URL(newUrl);\n      } catch (e) {\n        alert(\"invalid rpc url \" + newUrl);\n        return;\n      }\n      let rpc;\n      try {\n        const protocol = parsedUrl.protocol.split(\":\")[0] as any;\n        const fallbackPort = protocol === \"http\" ? 80 : 443;\n        const port = parseInt(parsedUrl.port, 10);\n        rpc = new ERPC({\n          transport: {\n            host: parsedUrl.hostname,\n            port: port ? port : fallbackPort,\n            type: protocol,\n            path: parsedUrl.pathname,\n          },\n        });\n      } catch (e) {\n        return;\n      }\n      if (rpc) {\n        setErpc(rpc);\n      }\n    };\n    runAsync();\n    return () => {\n      if (erpc) {\n        erpc.rpc.requestManager.close();\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedChain]);\n\n  return [erpc as ERPC, setSelectedChain];\n}\n\nexport default useEthRPC;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}