{"ast":null,"code":"import _slicedToArray from\"/root/experiment/nova-explorer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";import{Grid}from\"@material-ui/core\";import ChartCard from\"./ChartCard\";import{VictoryPie}from\"victory\";import{hexToString}from\"@etclabscore/eserialize\";import CustomPieChartLabel from\"./CustomPieChartLabel\";import{useTranslation}from\"react-i18next\";import _ from\"lodash\";var blockTopMinerCount=function blockTopMinerCount(blocks){var result=_(blocks).chain().countBy(function(b){return hexToString(b.extraData);}).map(function(key,val){return{x:val,y:key,label:val};}).sortBy(function(item){return item.y;}).reverse().value();return result;};var blockTopMinerCountByAddress=function blockTopMinerCountByAddress(blocks){var result=_(blocks).chain().countBy(function(b){return b.miner;}).map(function(key,val){return{x:val,y:key,label:val};}).sortBy(function(item){return item.y;}).reverse().value();return result;};var config={blockTime:15,// seconds\nblockHistoryLength:100,chartHeight:200,chartWidth:400};var MinerStats=function MinerStats(_ref){var blocks=_ref.blocks;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),showDefaultPieHover=_useState2[0],setShowDefaultPieHover=_useState2[1];var _useTranslation=useTranslation(),t=_useTranslation.t;return/*#__PURE__*/React.createElement(Grid,{container:true,justify:\"space-evenly\",alignItems:\"center\"},/*#__PURE__*/React.createElement(Grid,{key:\"uncles\",item:true,xs:12,md:4,lg:4},/*#__PURE__*/React.createElement(\"div\",{style:{margin:\"auto\",textAlign:\"center\"}},/*#__PURE__*/React.createElement(ChartCard,{title:t(\"Validators by Coinbase\")},/*#__PURE__*/React.createElement(VictoryPie,{cornerRadius:1// innerRadius={50}\n,colorScale:\"cool\",data:blockTopMinerCountByAddress(blocks),events:[{target:\"data\",eventHandlers:{onMouseOver:function onMouseOver(){return[{target:\"labels\",mutation:function mutation(){setShowDefaultPieHover(false);return{active:true};}}];}}}],labelComponent:/*#__PURE__*/React.createElement(CustomPieChartLabel,{defaultActive:showDefaultPieHover?blockTopMinerCountByAddress(blocks)[0]:undefined})})))),/*#__PURE__*/React.createElement(Grid,{key:\"uncles\",item:true,xs:12,md:3,lg:3},/*#__PURE__*/React.createElement(\"div\",{style:{margin:\"auto\",textAlign:\"center\"}},/*#__PURE__*/React.createElement(ChartCard,{title:t(\"Validators by Name\",{count:config.blockHistoryLength})},/*#__PURE__*/React.createElement(VictoryPie,{colorScale:\"cool\",labelComponent:/*#__PURE__*/React.createElement(CustomPieChartLabel,null),data:blockTopMinerCount(blocks)})))));};export default MinerStats;","map":{"version":3,"names":["React","useState","Grid","ChartCard","VictoryPie","hexToString","CustomPieChartLabel","useTranslation","_","blockTopMinerCount","blocks","result","chain","countBy","b","extraData","map","key","val","x","y","label","sortBy","item","reverse","value","blockTopMinerCountByAddress","miner","config","blockTime","blockHistoryLength","chartHeight","chartWidth","MinerStats","_ref","_useState","_useState2","_slicedToArray","showDefaultPieHover","setShowDefaultPieHover","_useTranslation","t","createElement","container","justify","alignItems","xs","md","lg","style","margin","textAlign","title","cornerRadius","colorScale","data","events","target","eventHandlers","onMouseOver","mutation","active","labelComponent","defaultActive","undefined","count"],"sources":["/root/experiment/nova-explorer/src/components/MinerStats.tsx"],"sourcesContent":["import React, { useState } from \"react\";\nimport { Grid } from \"@material-ui/core\";\nimport ChartCard from \"./ChartCard\";\nimport { VictoryPie } from \"victory\";\nimport { hexToString } from \"@etclabscore/eserialize\";\nimport CustomPieChartLabel from \"./CustomPieChartLabel\";\nimport { useTranslation } from \"react-i18next\";\nimport _ from \"lodash\";\n\nconst blockTopMinerCount = (blocks: any[]) => {\n  const result = _(blocks).chain()\n    .countBy((b: any) => hexToString(b.extraData))\n    .map((key: string, val: number) => ({\n      x: val,\n      y: key,\n      label: val,\n    }))\n    .sortBy((item: any) => item.y)\n    .reverse()\n    .value();\n  return result;\n};\n\nconst blockTopMinerCountByAddress = (blocks: any[]) => {\n  const result = _(blocks).chain()\n    .countBy((b: any) => b.miner)\n    .map((key: string, val: number) => ({\n      x: val,\n      y: key,\n      label: val,\n    }))\n    .sortBy((item: any) => item.y)\n    .reverse()\n    .value();\n  return result;\n};\n\ninterface IProps {\n  blocks: any[];\n  config: any;\n}\n\nconst config = {\n  blockTime: 15, // seconds\n  blockHistoryLength: 100,\n  chartHeight: 200,\n  chartWidth: 400,\n};\n\nconst MinerStats: React.FC<IProps> = ({blocks}) => {\n  const [showDefaultPieHover, setShowDefaultPieHover] = useState(true);\n  const { t } = useTranslation();\n\n  return (\n    <Grid container justify=\"space-evenly\" alignItems=\"center\">\n      <Grid key=\"uncles\" item xs={12} md={4} lg={4}>\n        <div style={{ margin: \"auto\", textAlign: \"center\" }}><ChartCard title={t(\"Validators by Coinbase\")}>\n          <VictoryPie\n            cornerRadius={1}\n            // innerRadius={50}\n            colorScale=\"cool\"\n            data={blockTopMinerCountByAddress(blocks)}\n            events={[{\n              target: \"data\",\n              eventHandlers: {\n                onMouseOver: () => {\n                  return [{\n                    target: \"labels\",\n                    mutation: () => {\n                      setShowDefaultPieHover(false);\n                      return { active: true };\n                    },\n                  }];\n                },\n              },\n            }]}\n            labelComponent={<CustomPieChartLabel {...{\n              defaultActive: showDefaultPieHover ? blockTopMinerCountByAddress(blocks)[0] : undefined,\n            }} />}\n          >\n          </VictoryPie>\n        </ChartCard>\n        </div>\n      </Grid>\n      <Grid key=\"uncles\" item xs={12} md={3} lg={3}>\n        <div style={{ margin: \"auto\", textAlign: \"center\" }}><ChartCard title={t(\"Validators by Name\", { count: config.blockHistoryLength })}>\n          <VictoryPie\n            colorScale=\"cool\"\n            labelComponent={<CustomPieChartLabel />}\n            data={blockTopMinerCount(blocks)}\n          />\n        </ChartCard>\n        </div>\n      </Grid>\n    </Grid>\n  );\n};\n\nexport default MinerStats;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}