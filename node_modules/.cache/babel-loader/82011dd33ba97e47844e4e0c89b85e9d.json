{"ast":null,"code":"import _slicedToArray from\"/root/experiment/nova-explorer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{CircularProgress,useTheme}from\"@material-ui/core\";import useEthRPCStore from\"../stores/useEthRPCStore\";import*as React from\"react\";import getBlocks,{useBlockNumber}from\"../helpers\";import MinerStats from\"../components/MinerStats\";import MinerStatsTable from\"../components/MinerStatsTable\";import StatCharts from\"../components/StatCharts\";import getTheme from\"../themes/victoryTheme\";import BlockPagination from\"../components/BlockPagination\";import _ from\"lodash\";var useState=React.useState;var config={blockTime:15,// seconds\nblockHistoryLength:100,chartHeight:200,chartWidth:400};export default(function(props){var _useEthRPCStore=useEthRPCStore(),_useEthRPCStore2=_slicedToArray(_useEthRPCStore,1),erpc=_useEthRPCStore2[0];var _useBlockNumber=useBlockNumber(erpc),_useBlockNumber2=_slicedToArray(_useBlockNumber,1),blockNumber=_useBlockNumber2[0];var _useState=useState(),_useState2=_slicedToArray(_useState,2),blocks=_useState2[0],setBlocks=_useState2[1];var theme=useTheme();var victoryTheme=getTheme(theme);var block=props.match.params.block;var blockNum=block!==undefined?parseInt(block,10):blockNumber;var from=Math.max(blockNum-99,0);var to=blockNum;React.useEffect(function(){if(blockNum===undefined||blockNumber===undefined){return;}if(blockNum>blockNumber){props.history.push(\"/stats/miners/\".concat(blockNumber));}if(blockNum<0){props.history.push(\"/stats/miners/0\");}},[blockNumber,blockNum,props.history]);React.useEffect(function(){if(!erpc){return;}getBlocks(from,to,erpc).then(function(bl){setBlocks(_.compact(bl));});// eslint-disable-next-line react-hooks/exhaustive-deps\n},[from,to]);if(!blocks||blockNumber===undefined||blockNum>blockNumber){return/*#__PURE__*/React.createElement(CircularProgress,null);}return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(BlockPagination,{from:from,to:to,disablePrev:blockNum>=blockNumber,disableNext:blockNum===0,onPrev:function onPrev(){var newQuery=blockNum+100;props.history.push(\"/stats/miners/\".concat(newQuery));},onNext:function onNext(){var newQuery=Math.max(blockNum-100,0);props.history.push(\"/stats/miners/\".concat(newQuery));}}),/*#__PURE__*/React.createElement(StatCharts,{blocks:blocks,victoryTheme:victoryTheme}),/*#__PURE__*/React.createElement(MinerStats,{blocks:blocks,config:config}),/*#__PURE__*/React.createElement(MinerStatsTable,{blocks:blocks}));});","map":{"version":3,"names":["CircularProgress","useTheme","useEthRPCStore","React","getBlocks","useBlockNumber","MinerStats","MinerStatsTable","StatCharts","getTheme","BlockPagination","_","useState","config","blockTime","blockHistoryLength","chartHeight","chartWidth","props","_useEthRPCStore","_useEthRPCStore2","_slicedToArray","erpc","_useBlockNumber","_useBlockNumber2","blockNumber","_useState","_useState2","blocks","setBlocks","theme","victoryTheme","block","match","params","blockNum","undefined","parseInt","from","Math","max","to","useEffect","history","push","concat","then","bl","compact","createElement","Fragment","disablePrev","disableNext","onPrev","newQuery","onNext"],"sources":["/root/experiment/nova-explorer/src/containers/MinerStatsPage.tsx"],"sourcesContent":["import { CircularProgress, useTheme, Theme } from \"@material-ui/core\";\nimport useEthRPCStore from \"../stores/useEthRPCStore\";\nimport * as React from \"react\";\nimport getBlocks, { useBlockNumber } from \"../helpers\";\nimport MinerStats from \"../components/MinerStats\";\nimport MinerStatsTable from \"../components/MinerStatsTable\";\nimport StatCharts from \"../components/StatCharts\";\nimport getTheme from \"../themes/victoryTheme\";\nimport BlockPagination from \"../components/BlockPagination\";\nimport { History } from \"history\";\nimport _ from \"lodash\";\nimport { Block as IBlock } from \"@etclabscore/ethereum-json-rpc\";\n\nconst useState = React.useState;\n\nconst config = {\n  blockTime: 15, // seconds\n  blockHistoryLength: 100,\n  chartHeight: 200,\n  chartWidth: 400,\n};\ninterface IProps {\n  match: {\n    params: {\n      address: string,\n      block: string,\n    };\n  };\n  history: History;\n}\n\nexport default (props: IProps) => {\n  const [erpc] = useEthRPCStore();\n  const [blockNumber] = useBlockNumber(erpc);\n  const [blocks, setBlocks] = useState<IBlock[]>();\n  const theme = useTheme<Theme>();\n  const victoryTheme = getTheme(theme);\n  const { block } = props.match.params;\n  const blockNum = block !== undefined ? parseInt(block, 10) : blockNumber;\n  const from = Math.max(blockNum - 99, 0);\n  const to = blockNum;\n\n  React.useEffect(() => {\n    if (blockNum === undefined || blockNumber === undefined) {\n      return;\n    }\n    if (blockNum > blockNumber) {\n      props.history.push(`/stats/miners/${blockNumber}`);\n    }\n    if (blockNum < 0) {\n      props.history.push(`/stats/miners/0`);\n    }\n  }, [blockNumber, blockNum, props.history]);\n\n  React.useEffect(() => {\n    if (!erpc) { return; }\n    getBlocks(\n      from,\n      to,\n      erpc,\n    ).then((bl) => {\n      setBlocks(_.compact(bl));\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [from, to]);\n\n  if (!blocks || blockNumber === undefined || blockNum > blockNumber) {\n    return (<CircularProgress />);\n  }\n\n  return (\n    <>\n      <BlockPagination\n        from={from}\n        to={to}\n        disablePrev={blockNum >= blockNumber}\n        disableNext={blockNum === 0}\n        onPrev={() => {\n          const newQuery = blockNum + 100;\n          props.history.push(`/stats/miners/${newQuery}`);\n        }}\n        onNext={() => {\n          const newQuery = Math.max(blockNum - 100, 0);\n          props.history.push(`/stats/miners/${newQuery}`);\n        }}\n      ></BlockPagination>\n      <StatCharts blocks={blocks} victoryTheme={victoryTheme} />\n      <MinerStats blocks={blocks} config={config} />\n      <MinerStatsTable blocks={blocks} />\n    </>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}